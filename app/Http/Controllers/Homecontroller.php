<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Post;
use App\Models\Category;
use App\Models\Comment;

class Homecontroller extends Controller
{
    public function home(Request $request){
        if($request->has('q')){
    		$q=$request->q;
    		$posts=Post::where('detail','like','%'.$q.'%')->where('idcat',1)->orderBy('id','desc')->get();
            $plans=Post::where('detail','like','%'.$q.'%')->where('idcat',2)->orderBy('id','desc')->get();
            $events=Post::where('detail','like','%'.$q.'%')->where('idcat',3)->orderBy('id','desc')->get();
    	}else{
    		$posts=Post::orderBy('id','desc')->where('idcat',1)->get();
            $plans = Post::orderBy('id' , 'desc')->where('idcat',2)->get();
            $events = Post::orderBy('id' , 'desc')->where('idcat' , 3)->get();
    	}
        return view('home' , ['posts' => $posts , 'plans' =>$plans , 'events'=>$events]);
    }

    //POST DETAILS 
    public function detail(Request $request , $slug , $pid){
        $detail= Post::find($pid);

        return view('detail' , ['detail' => $detail]);
    }

    //addig comments to Posts 
    public function save_comment(Request $request , $slug , $id ){
        $request->validate([
            'email'=>'required',
            'comment'=>'required'
        ]);

        $cms = new Comment;
        $cms->post_id=$id;
        $cms->email=$request->email;
        $cms->comment=$request->comment;
        $cms->status=0;
        $cms->save();
        return redirect('detail/'.$slug.'/'.$id)->with('success',' Votre Commentaire a bien ajout√©.');

    }

}



























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































